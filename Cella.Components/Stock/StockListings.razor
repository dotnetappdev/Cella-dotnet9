@page "/admin/stock/edit"
@using Cella.Models
@using Microsoft.AspNetCore.Components.QuickGrid

<h3>Stock Item Management</h3>

<button class="btn btn-primary mb-3" @onclick="OpenDialog">Add/Edit Stock Item</button>

@if (showDialog)
{
    <div class="modal fade show d-block" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content p-4">
                <h4 class="modal-title mb-3">Add/Edit Stock Item</h4>
                <StockForm Model="stockItem" OnValidSubmit="HandleValidSubmit" OnCancel="CloseDialog" />
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

<QuickGrid Items="@stockItems">
    <PropertyColumn Property="@(p => p.Name)" Sortable="true" />

    <PropertyColumn Property="@(p => p.BarCode)" Sortable="true" />

    <PropertyColumn Property="@(p => p.Description)" Sortable="true" />

    <PropertyColumn Property="@(p => p.AvailableStartDate)" Format="yyyy-MM-dd" Sortable="true" />
    <PropertyColumn Property="@(p => p.AvailableEndDate)" Format="yyyy-MM-dd" Sortable="true" />
    
    <!-- Replace PropertyColumn for nullable bools -->
    <Column Title="Active">
        <CellTemplate Context="item">
            @(stockItem.isActive == true ? "Yes" : "No")
        </CellTemplate>
    </Column>
    <Column Title="Deleted">
        <CellTemplate Context="item">
            @(stockItem.isDeleted == true ? "Yes" : "No")
        </CellTemplate>
    </Column>
</QuickGrid>

@code {
    private List<StockItemVm> stockItemList = new();

    private IQueryable<StockItemVm> stockItems => stockItemList.AsQueryable();

    private StockItemVm stockItem = new();
    private bool showDialog = false;

    private void OpenDialog()
    {
        stockItem = new StockItemVm();
        showDialog = true;
    }

    private void CloseDialog()
    {
        showDialog = false;
    }

    private void HandleValidSubmit()
    {
        stockItemList.Add(stockItem);
        showDialog = false;
    }
}
